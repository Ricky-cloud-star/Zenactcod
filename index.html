<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>封面验证</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }

        .coverContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #b8860b, #000000);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .coverContent {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .coverContent input {
            padding: 12px;
            margin-top: 20px;
            margin-bottom: 20px;
            font-size: 16px;
            width: 80%;
            border-radius: 8px;
            border: 1px solid #ccc;
        }

        .coverContent button {
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
        }

        .coverTitle {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }
    </style>
</head>
<body>
    <!-- 封面模块 -->
    <div class="coverContainer" id="coverContainer">
        <div class="coverContent">
            <div class="coverTitle">欢迎来到Ricky的工具箱</div>
            <h2>你是谁？</h2>
            <input type="text" id="identityInput" placeholder="输入您的名字">
            <br>
            <button onclick="checkIdentity()">提交</button>
            <div id="errorMessage" style="color: red; margin-top: 10px;"></div>
        </div>
    </div>

    <script>
        // 封面问题验证功能
        function checkIdentity() {
            const identity = document.getElementById('identityInput').value.trim();
            const validIdentities = ["Nala", "Lucy"]; // 设置允许的答案

            if (validIdentities.includes(identity)) {
                document.getElementById('coverContainer').style.display = 'none';
            } else {
                document.getElementById('errorMessage').textContent = '回答错误，请重试。';
            }
        }
    </script>
</body>
</html>

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>库存数据处理器</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            margin-top: 20px;
            position: relative;
        }

        .leftPanel {
            flex: 3;
            margin-right: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .fileContainer {
            text-align: center;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .buttons {
            margin-top: 20px;
            text-align: center;
        }

        #dropArea {
            width: 80%;
            height: 100px;
            border: 2px dashed #aaa;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            color: #888;
            transition: border-color 0.3s, color 0.3s;
        }
        #dropArea.dragover {
            border-color: #00aaff;
            color: #00aaff;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            font-size: 12px;
            position: relative;
        }

        th {
            background-color: #bca87e;
            color: #000000;
            font-size: 12px;
        }

        .rightPanel {
            width: 280px;
            height: auto;
            border: 2px solid #d4af37;
            padding: 10px;
            background-color: #fff8e1;
            position: absolute;
            top: 20px;
            right: 20px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .file-label {
            margin-bottom: 10px;
            display: block;
            text-align: center;
            color: #555;
            font-size: 14px;
        }

        #csvFileInput {
            display: none;
        }

        .file-label i {
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="leftPanel">
            <h1 class="header">库存数据处理器</h1>
            <div class="fileContainer">
                <label for="csvFileInput" class="file-label"><i class="fas fa-file-upload"></i> Select a CSV file or drag and drop below</label>
                <input type="file" id="csvFileInput" accept=".csv" />
            </div>
            <div id="dropArea">Drag and drop your CSV file here</div>
            <div class="buttons">
                <button onclick="convertToXLSM()">Convert to XLSM</button>
            </div>
        </div>
        <div class="rightPanel">
            <h3>查询结果</h3>
            <div id="rowPosition1">请先选择文件。</div>
        </div>
    </div>

    <script>
        const dropArea = document.getElementById('dropArea');
        const fileInput = document.getElementById('csvFileInput');
        let csvFile;

        dropArea.addEventListener('dragover', (event) => {
            event.preventDefault();
            dropArea.classList.add('dragover');
        });

        dropArea.addEventListener('dragleave', () => {
            dropArea.classList.remove('dragover');
        });

        dropArea.addEventListener('drop', (event) => {
            event.preventDefault();
            dropArea.classList.remove('dragover');
            csvFile = event.dataTransfer.files[0];
            if (csvFile && csvFile.type === 'text/csv') {
                dropArea.textContent = `File ready: ${csvFile.name}`;
                document.getElementById('rowPosition1').textContent = `已选择文件：${csvFile.name}`;
            } else {
                alert('Please drop a valid CSV file.');
            }
        });

        fileInput.addEventListener('change', (event) => {
            csvFile = event.target.files[0];
            if (csvFile && csvFile.type === 'text/csv') {
                dropArea.textContent = `File ready: ${csvFile.name}`;
                document.getElementById('rowPosition1').textContent = `已选择文件：${csvFile.name}`;
            } else {
                alert('Please select a valid CSV file.');
            }
        });

        function convertToXLSM() {
            if (!csvFile) {
                alert("Please upload or drop a CSV file first.");
                return;
            }

            // 使用FileReader来读取文件
            const reader = new FileReader();
            reader.onload = function(event) {
                const csvData = event.target.result;

                // 使用SheetJS读取CSV数据
                const workbook = XLSX.read(csvData, { type: 'string' });

                // 创建新的工作簿并添加工作表
                const newWorkbook = XLSX.utils.book_new();
                let worksheet = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]], { header: 1 });

                // 1. 去除所有单元格中的前后空格
                worksheet = worksheet.map(row => row.map(cell => (typeof cell === 'string' ? cell.trim() : cell)));

                // 2. 在第13行找到"Item Number"，在第14行找到"Location/Lot"
                let itemNumberCol = -1;
                let locationLotCol = -1;
                worksheet[12].forEach((cell, index) => {
                    if (cell === "Item Number") {
                        itemNumberCol = index;
                    }
                });
                worksheet[13].forEach((cell, index) => {
                    if (cell === "Location/Lot") {
                        locationLotCol = index;
                    }
                });

                // 3. 将第14行中的"Location/Lot"往右移动一个单元格，将第13行中的"Item Number"往下移动至第14行
                if (locationLotCol !== -1) {
                    worksheet[13].splice(locationLotCol + 1, 0, worksheet[13][locationLotCol]);
                    worksheet[13][locationLotCol] = "Location/Lot"; // 保留"Location/Lot"标题
                }
                if (itemNumberCol !== -1) {
                    worksheet[13][itemNumberCol] = worksheet[12][itemNumberCol];
                    worksheet[12][itemNumberCol] = "";
                }

                // 4. 根据第14行"Item Number"的位置，删除上方的所有行和左侧的所有列
                if (itemNumberCol !== -1) {
                    worksheet = worksheet.slice(13); // 删除上方的所有行
                    worksheet = worksheet.map(row => row.slice(itemNumberCol)); // 删除左侧的所有列
                }

                // 5. 定位到B2单元格，删除这个单元格，将下方单元格上移
                if (worksheet.length > 1 && worksheet[1].length > 1) {
                    for (let i = 1; i < worksheet.length - 1; i++) {
                        worksheet[i][1] = worksheet[i + 1][1];
                    }
                    worksheet[worksheet.length - 1][1] = ""; // 最后一行置为空
                }

                // 6. 筛选B列，选择所有空白行，将B列中空白单元格所在行全部删除
                worksheet = worksheet.filter((row, rowIndex) => {
                    if (rowIndex === 0) return true; // 保留标题行
                    return row[1] && row[1].toString().trim() !== ""; // 删除B列为空的行
                });

                // 7. 将C列和E列删除
                worksheet = worksheet.map(row => row.filter((_, colIndex) => colIndex !== 2 && colIndex !== 4));

                // 8. 定位到D1，将其移动至C1; 定位到F1，将其移动到E1
                if (worksheet.length > 0) {
                    if (worksheet[0].length > 3) {
                        worksheet[0][2] = worksheet[0][3];
                        worksheet[0][3] = "";
                    }
                    if (worksheet[0].length > 5) {
                        worksheet[0][4] = worksheet[0][5];
                        worksheet[0][5] = "";
                    }
                }

                // 9. 删除D列
                worksheet = worksheet.map(row => row.filter((_, colIndex) => colIndex !== 3));

                // 10. 定位到F1，将其移动到E1; 定位到H1，将其移动到G1
                if (worksheet.length > 0) {
                    if (worksheet[0].length > 4) {
                        worksheet[0][4] = worksheet[0][5];
                        worksheet[0][5] = "";
                    }
                    if (worksheet[0].length > 6) {
                        worksheet[0][6] = worksheet[0][7];
                        worksheet[0][7] = "";
                    }
                }

                // 11. 删除F, H, I列
                worksheet = worksheet.map(row => row.filter((_, colIndex) => colIndex !== 5 && colIndex !== 7 && colIndex !== 8));

                // 12. 定位到J1，将其移动到I1; 定位到L1，将其移动到K1
                if (worksheet.length > 0) {
                    if (worksheet[0].length > 8) {
                        worksheet[0][8] = worksheet[0][9];
                        worksheet[0][9] = "";
                    }
                    if (worksheet[0].length > 10) {
                        worksheet[0][10] = worksheet[0][11];
                        worksheet[0][11] = "";
                    }
                }

                // 13. 删除H列和J列
                worksheet = worksheet.map(row => row.filter((_, colIndex) => colIndex !== 7 && colIndex !== 9));

                // 将修改后的数据添加到新的工作簿中
                const newWorksheet = XLSX.utils.aoa_to_sheet(worksheet);
                XLSX.utils.book_append_sheet(newWorkbook, newWorksheet, "Sheet1");

                // 设置写入选项，保存为xlsm格式
                const writeOptions = {
                    bookType: 'xlsm',
                    bookSST: false,
                    type: 'binary'
                };
                const wbout = XLSX.write(newWorkbook, writeOptions);

                // 将内容转换为blob
                function s2ab(s) {
                    const buf = new ArrayBuffer(s.length);
                    const view = new Uint8Array(buf);
                    for (let i = 0; i < s.length; i++) {
                        view[i] = s.charCodeAt(i) & 0xFF;
                    }
                    return buf;
                }

                // 创建blob对象并下载
                const blob = new Blob([s2ab(wbout)], { type: "application/vnd.ms-excel.sheet.macroEnabled.12" });
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = "output.xlsm";
                link.click();

                document.getElementById('rowPosition1').textContent = `文件已导出至：${link.download}`;
            };
            
            // 读取文件为文本字符串
            reader.readAsText(csvFile);
        }
    </script>
</body>
</html>

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>DTS Software Licensing</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            margin-top: 20px;
            position: relative;
        }

        .leftPanel {
            flex: 3;
            margin-right: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .fileContainer {
            text-align: left;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .searchContainer {
            margin-bottom: 20px;
            text-align: left;
            margin-top: 10px;
        }

        #resultTable1 {
            width: 100%;
            margin-top: 20px;
        }

        .resultTable {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            font-size: 12px;
            position: relative;
        }

        th {
            background-color: #bca87e;
            color: #000000;
            font-size: 12px;
        }

        .rightPanel {
            width: 320px;
            height: auto;
            border: 2px solid #d4af37;
            padding: 15px;
            background-color: #fff8e1;
            position: absolute;
            top: 20px;
            right: 20px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .copyIcon {
            position: absolute;
            top: 50%;
            right: 5px;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 14px;
            color: #d4af37;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <!-- 第一个模块 -->
    <div class="container" id="container1">
        <div class="leftPanel">
            <h1 class="header">DTS Software Licensing</h1>

            <!-- 选择文件按钮 -->
            <div class="fileContainer">
                <input type="file" id="fileInput1" accept=".xlsx, .xlsm, .xls" />
            </div>

            <!-- 输入框和搜索按钮 -->
            <div class="searchContainer">
                <input type="text" class="jdeOrderNumber" id="jdeOrderNumber1" placeholder="Enter JDE Order Number">
                <button class="searchButton" onclick="handleSearch1()">Search</button>
                <button class="clearButton" onclick="clearResults1()">Clear</button>
                
                <input type="text" id="githubTokenInput" placeholder="Enter GitHub Token" style="margin-left: 10px;">
                <button class="cloudSearchButton" onclick="handleCloudSearch1()">从云端搜索数据</button>
            </div>

            <!-- 选择数据验证文件按钮 -->
            <div class="fileContainer">
                <input type="file" id="validationFileInput" accept=".csv, .xlsx, .xlsm, .xls" />
                <button class="validateButton" onclick="handleValidation()">查验数据</button>
                <button class="validateButton2" onclick="handleValidation2()">查验数据2</button>
            </div>

            <!-- 表格显示区域 -->
            <div id="contentPreview1">
                <table class="resultTable" id="resultTable1">
                    <thead>
                        <tr>
                            <th>JDE Order Type</th>
                            <th>JDE Order Number</th>
                            <th>Shipping Contact: First Name</th>
                            <th>Shipping Contact: Last Name</th>
                            <th>Shipping Contact: Email</th>
                            <th>Company to ship: JDE Address Number</th>
                            <th>Company to ship: Account Name</th>
                        </tr>
                    </thead>
                    <tbody id="resultBody1"></tbody>
                </table>
            </div>
        </div>
        <div class="rightPanel">
            <h3>查询结果</h3>
            <div id="rowPosition1">请先选择文件并输入JDE订单号。</div>
        </div>
    </div>

    <script>
        // 模块1的JavaScript功能
        (function() {
            let workbook1;
            let validationWorkbook;

            document.getElementById('fileInput1').addEventListener('change', handleFile1);
            document.getElementById('validationFileInput').addEventListener('change', handleValidationFile);

            function handleFile1(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const data = new Uint8Array(e.target.result);
                        workbook1 = XLSX.read(data, { type: 'array' });
                        document.getElementById('rowPosition1').textContent = `已选择文件：${file.name}`;
                    };
                    reader.readAsArrayBuffer(file);
                }
            }

            function handleValidationFile(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const data = new Uint8Array(e.target.result);
                        validationWorkbook = XLSX.read(data, { type: 'array' });
                        document.getElementById('rowPosition1').textContent = `已选择验证文件：${file.name}`;
                    };
                    reader.readAsArrayBuffer(file);
                }
            }

            async function handleCloudSearch1() {
                const githubToken = document.getElementById('githubTokenInput').value.trim();
                if (!githubToken) {
                    alert("令牌不能为空！");
                    return;
                }
                updateResponseBox("正在从云端获取数据");

                const inputOrderNumbers = document.getElementById('jdeOrderNumber1').value.trim().split('&');
                const trimmedOrderNumbers = inputOrderNumbers.map(num => num.trim());
                try {
                    const repoOwner = 'Ricky-cloud-star';
                    const repoName = 'Mail-excel';
                    const filePath = 'data/data.csv';
                    const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`;

                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Authorization': `token ${githubToken}`,
                            'Accept': 'application/vnd.github.v3.raw'
                        }
                    });

                    if (response.ok) {
                        const csvText = await response.text();
                        searchInCSV(csvText, trimmedOrderNumbers);
                        updateResponseBox('数据导入成功');
                    } else {
                        const responseData = await response.json();
                        alert(`导入失败：${responseData.message}`);
                        updateResponseBox('数据导入失败');
                    }
                } catch (error) {
                    alert(`导入过程中发生错误：${error.message}`);
                    updateResponseBox('数据导入失败');
                }
            }

            function handleValidation2() {
                if (!validationWorkbook) {
                    alert("请先选择数据验证文件。");
                    return;
                }

                const validationSheet = validationWorkbook.Sheets['Sheet1'];
                if (!validationSheet) {
                    document.getElementById('rowPosition1').textContent = "未找到Sheet1。";
                    return;
                }

                const validationData = XLSX.utils.sheet_to_json(validationSheet, { header: 1 });
                const orderReferenceIndex = validationData[0].indexOf("Order Reference ID");
                const customerAccountIndex = validationData[0].indexOf("Customer Account Reference ID");
                const customerIndex = validationData[0].indexOf("Customer");
                const validationOrders = validationData.slice(1);

                const displayedOrders = Array.from(document.querySelectorAll('#resultBody1 tr'));
                let resultMessage = "";

                displayedOrders.forEach(row => {
                    const jdeOrderNumber = row.querySelector('td:nth-child(2)').childNodes[0].textContent.trim();
                    const jdeAddressNumber = row.querySelector('td:nth-child(6)').childNodes[0].textContent.trim();
                    const accountName = row.querySelector('td:nth-child(7)').childNodes[0].textContent.trim();

                    const validationRow = validationOrders.find(order => order[orderReferenceIndex].toString().trim() === jdeOrderNumber);
                    if (validationRow) {
                        const expectedAddressNumber = validationRow[customerAccountIndex].toString().trim();
                        const expectedAccountName = validationRow[customerIndex].toString().trim();

                        if (jdeAddressNumber === expectedAddressNumber && accountName === expectedAccountName) {
                            resultMessage += `订单号 ${jdeOrderNumber} 匹配正确。\n`;
                        } else {
                            if (jdeAddressNumber !== expectedAddressNumber) {
                                resultMessage += `订单号 ${jdeOrderNumber} 的 JDE Address Number 不一致。\n`;
                            }
                            if (accountName !== expectedAccountName) {
                                resultMessage += `订单号 ${jdeOrderNumber} 的 Account Name 不一致。\n`;
                            }
                        }
                    } else {
                        resultMessage += `订单号 ${jdeOrderNumber} 在验证文件中未找到。\n`;
                    }
                });

                document.getElementById('rowPosition1').textContent = resultMessage || "数据验证通过，所有订单号匹配。";
            }

            function searchInCSV(csvText, orderNumbers) {
                if (!csvText) {
                    alert('导入的数据为空！');
                    return;
                }

                const rows = csvText.trim().split("\n");
                const resultBody = document.getElementById('resultBody1');
                resultBody.innerHTML = '';

                let found = false;
                for (let i = 1; i < rows.length; i++) { // 跳过表头
                    const rowArray = rows[i].split(",");
                    if (orderNumbers.includes(rowArray[1].replace('.0', '').toString())) {
                        const newRow = document.createElement('tr');
                        for (let j = 0; j < 7; j++) {
                            const cell = document.createElement('td');
                            cell.textContent = (rowArray[j] !== undefined && !isNaN(rowArray[j]) && rowArray[j] % 1 === 0) ? parseInt(rowArray[j]) : rowArray[j] !== undefined ? rowArray[j] : '';
                            if (j === 1 || j === 2 || j === 3 || j === 4 || j === 5 || j === 6) { // 添加复制图标
                                const copyIcon = document.createElement('span');
                                copyIcon.className = 'copyIcon';
                                copyIcon.innerHTML = '📋';
                                copyIcon.onclick = function() {
                                    copyCellContent(cell);
                                };
                                cell.appendChild(copyIcon);
                            }
                            newRow.appendChild(cell);
                        }
                        resultBody.appendChild(newRow);
                        found = true;
                    }
                }
                if (!found) {
                    document.getElementById('rowPosition1').textContent += "\n未找到订单数据。";
                }
            }

            function handleValidation() {
                if (!validationWorkbook) {
                    alert("请先选择数据验证文件。");
                    return;
                }

                const validationSheet = validationWorkbook.Sheets['Sheet1'];
                if (!validationSheet) {
                    document.getElementById('rowPosition1').textContent = "未找到Sheet1。";
                    return;
                }

                const validationData = XLSX.utils.sheet_to_json(validationSheet, { header: 1 });
                const orderReferenceIds = validationData.slice(1).map(row => row[validationData[0].indexOf("Order Reference ID")].toString().trim());

                const displayedOrderNumbers = Array.from(document.querySelectorAll('#resultBody1 tr td:nth-child(2)')).map(td => td.childNodes[0].textContent.trim());

                let missingInValidation = displayedOrderNumbers.filter(orderNumber => !orderReferenceIds.includes(orderNumber));
                let missingInDisplay = orderReferenceIds.filter(orderId => !displayedOrderNumbers.includes(orderId));

                let resultMessage = "";
                if (missingInValidation.length > 0) {
                    resultMessage += `在验证文件中缺少的订单号: ${missingInValidation.join(", ")}\n`;
                }
                if (missingInDisplay.length > 0) {
                    resultMessage += `在下方表格中缺少的订单号: ${missingInDisplay.join(", ")}`;
                }
                document.getElementById('rowPosition1').textContent = resultMessage || "数据验证通过，所有订单号匹配。";
            }

            function clearResults1() {
                document.getElementById('resultBody1').innerHTML = '';
                document.getElementById('rowPosition1').textContent = '请先选择文件并输入JDE订单号。';
                document.getElementById('jdeOrderNumber1').value = '';
            }

            function copyCellContent(cell) {
                const cellContent = cell.childNodes[0] ? cell.childNodes[0].textContent.trim() : cell.textContent.trim();
                if (cellContent === '') {
                    return;
                }

                const tempInput = document.createElement('textarea');
                tempInput.value = cellContent;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);

                document.getElementById('rowPosition1').textContent = "已复制内容: " + cellContent;
            }

            function updateResponseBox(message) {
                document.getElementById('rowPosition1').textContent = message;
            }

            window.handleSearch1 = handleCloudSearch1;
            window.clearResults1 = clearResults1;
            window.handleCloudSearch1 = handleCloudSearch1;
            window.handleValidation = handleValidation;
            window.handleValidation2 = handleValidation2;
        })();
    </script>
</body>
</html>

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Zen激活码辅助工具</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            margin-top: 20px;
            position: relative;
        }

        .leftPanel {
            flex: 3;
            margin-right: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        #inputContainer {
            margin-top: 10px;
            margin-bottom: 10px;
            text-align: left;
        }

        #partNoInput, #addButton, #addButton2, #autoAddButton, #submitButton, #importButton, #fileSelectButton, #validateButton {
            padding: 8px;
            font-size: 14px;
            margin-right: 5px;
        }

        #addButton, #addButton2, #autoAddButton, #submitButton, #importButton, #fileSelectButton, #validateButton {
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #addButton:hover, #addButton2:hover, #autoAddButton:hover, #submitButton:hover, #importButton:hover, #fileSelectButton:hover, #validateButton:hover {
            background-color: #45a049;
        }

        .deleteButton {
            padding: 5px 10px;
            font-size: 12px;
            margin-left: 5px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .deleteButton:hover {
            background-color: #d32f2f;
        }

        .deleteHeaderIcon {
            cursor: pointer;
            font-size: 18px;
            color: #f44336;
            margin-left: 10px;
        }

        .resultTable {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            font-size: 12px;
            position: relative;
        }

        th {
            background-color: #607d8b;
            color: #fff;
            font-size: 12px;
        }

        #responseBox {
            width: 320px;
            height: auto;
            border: 2px solid #d4af37;
            padding: 15px;
            background-color: #fff8e1;
            position: absolute;
            top: 20px; /* 将响应窗口上移，与标题平行 */
            right: 20px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }

        #responseTitle {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
            color: #d4af37;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container" id="container2">
        <div class="leftPanel">
            <h1 class="header">Zen激活码辅助工具</h1>

            <div id="inputContainer">
                <input type="text" id="partNoInput" placeholder="Enter SO">
                <button id="addButton" onclick="addNewRow()">新增</button>
                <button id="addButton2" onclick="addNewHeader()">新增2</button>
                <button id="autoAddButton" onclick="autoAddRows()">自动新增</button> <!-- 新增的自动新增按钮 -->
                <button id="submitButton" onclick="submitDataToBackend()">提交数据</button>
                <button id="importButton" onclick="importDataFromGithub()">导入数据</button>
                <input type="file" id="fileInput" accept=".csv, .xlsx, .xlsm, .xls" style="margin-right: 5px;">
                <button id="validateButton" onclick="validateData()">数据核验</button>
            </div>

            <div id="contentPreview2">
                <!-- 表格显示区域，用户可以自由添加 -->
            </div>
        </div>
        <div id="responseBox">
            <div id="responseTitle">响应窗口</div>
            <div id="responseMessage" style="font-size: 14px; color: #333;"></div>
        </div>
    </div>

    <script>
        let headerCounter = 1;
        let rowCount = 1;
        let workbook;

        document.getElementById('fileInput').addEventListener('change', handleFileSelect);

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const data = new Uint8Array(e.target.result);
                    workbook = XLSX.read(data, { type: 'array' });
                    updateResponseBox(`已选择文件：${file.name}`);
                };
                reader.readAsArrayBuffer(file);
            }
        }

        function addNewHeader() {
            headerCounter++;
            const container2 = document.getElementById('contentPreview2');
            const newTable = document.createElement('table');
            newTable.className = 'resultTable';
            newTable.id = `resultTable2_${headerCounter}`;

            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            const headers = ['序号', 'SO', 'Part No', 'Qty', '序列号', '日期', '操作'];

            headers.forEach(headerText => {
                const th = document.createElement('th');
                th.textContent = headerText;
                headerRow.appendChild(th);
            });

            // 添加删除表头的垃圾桶图标
            const deleteHeaderIcon = document.createElement('span');
            deleteHeaderIcon.className = 'deleteHeaderIcon';
            deleteHeaderIcon.innerHTML = '🗑️';
            deleteHeaderIcon.onclick = function() {
                container2.removeChild(newTable);
            };
            headerRow.appendChild(deleteHeaderIcon);

            thead.appendChild(headerRow);
            newTable.appendChild(thead);

            const tbody = document.createElement('tbody');
            newTable.appendChild(tbody);

            container2.appendChild(newTable);
        }

        async function importDataFromGithub() {
            updateResponseBox("正在导入数据");

            // 1. 弹窗让用户输入GitHub令牌
            const githubToken = prompt("请输入您的 GitHub 令牌：");
            if (!githubToken) {
                alert("令牌不能为空！");
                return;
            }

            try {
                // 2. 通过GitHub API获取数据
                const repoOwner = 'Ricky-cloud-star';  // 替换为您的GitHub用户名
                const repoName = 'Zenactcod';           // 替换为您的仓库名称
                const filePath = 'data/data.csv';       // 替换为文件路径，例如 'data/data.csv'
                const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`;

                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Accept': 'application/vnd.github.v3.raw'
                    }
                });

                if (response.ok) {
                    const csvText = await response.text();
                    populateTable(csvText); // 调用现有的函数以将数据填入页面
                    updateResponseBox('数据导入成功');
                } else {
                    const responseData = await response.json();
                    alert(`导入失败：${responseData.message}`);
                    updateResponseBox('数据导入失败');
                }
            } catch (error) {
                alert(`导入过程中发生错误：${error.message}`);
                updateResponseBox('数据导入失败');
            }
        }

        function populateTable(csvText) {
            if (!csvText) {
                alert('导入的数据为空！');
                return;
            }

            const rows = csvText.trim().split("\n");
            let currentTable;
            headerCounter = 1;
            rowCount = 1;

            rows.forEach((rowText, index) => {
                const rowArray = rowText.split(",");
                if (index === 0 || rowArray[0] === '序号') {
                    addNewHeader();
                    currentTable = document.querySelector(`#contentPreview2 table:last-of-type tbody`);
                } else if (currentTable) {
                    const newRow = document.createElement('tr');
                    rowArray.forEach((cellText, i) => {
                        if (i < rowArray.length - 1) { // Skip adding text for the '操作' column
                            const cell = document.createElement('td');
                            cell.textContent = cellText;
                            newRow.appendChild(cell);
                        }
                    });

                    // 重新添加操作按钮
                    const actionCell = document.createElement('td');
                    const copyButton = document.createElement('button');
                    copyButton.textContent = "一键复制";
                    copyButton.className = "copyButton";
                    copyButton.onclick = function() {
                        copySerialNumber(newRow.children[4]);
                    };
                    actionCell.appendChild(copyButton);

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = "删除";
                    deleteButton.className = "deleteButton";
                    deleteButton.onclick = function() {
                        currentTable.removeChild(newRow);
                    };
                    actionCell.appendChild(deleteButton);

                    newRow.appendChild(actionCell);
                    currentTable.appendChild(newRow);
                    rowCount++;
                }
            });

            // 为导入的 SO 列添加复制图标
            addCopyToSOCells();
        }

        function autoAddRows() {
            const partNoInput = document.getElementById('partNoInput').value.trim();
            if (!workbook) {
                updateResponseBox("请先选择文件。");
                return;
            }

            if (!partNoInput) {
                updateResponseBox("请输入订单号。");
                return;
            }

            const orderNumbers = partNoInput.split('&').map(order => order.trim());
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });
            const headers = data[0];
            const orderNumberIndex = headers.indexOf("Order Number");
            const lnTyIndex = headers.indexOf("Ln Ty");
            const itemNumberIndex = headers.indexOf("2nd Item Number");

            if (orderNumberIndex === -1 || lnTyIndex === -1 || itemNumberIndex === -1) {
                updateResponseBox("Excel 文件缺少必要的列。");
                return;
            }

            orderNumbers.forEach(orderNumber => {
                // 为每个订单号创建一个新表头
                addNewHeader();
                const newTableBody = document.querySelector(`#resultTable2_${headerCounter} tbody`);

                let rowCountForOrder = 0;
                data.slice(1).forEach(row => {
                    if (row[orderNumberIndex] == orderNumber && row[lnTyIndex] === "N1") {
                        rowCountForOrder++;

                        const newRow = document.createElement('tr');

                        const serialNumberCell = document.createElement('td');
                        serialNumberCell.textContent = rowCount++;
                        newRow.appendChild(serialNumberCell);

                        const soCell = document.createElement('td');
                        soCell.textContent = orderNumber;
                        newRow.appendChild(soCell);

                        const partNoCell = document.createElement('td');
                        partNoCell.textContent = row[itemNumberIndex];
                        newRow.appendChild(partNoCell);

                        const qtyCell = document.createElement('td');
                        qtyCell.contentEditable = true;
                        newRow.appendChild(qtyCell);

                        const serialCell = document.createElement('td');
                        serialCell.contentEditable = true;
                        newRow.appendChild(serialCell);

                        const dateCell = document.createElement('td');
                        const today = new Date();
                        const formattedDate = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0') + '-' + String(today.getDate()).padStart(2, '0');
                        dateCell.textContent = formattedDate;
                        dateCell.contentEditable = true;
                        newRow.appendChild(dateCell);

                        // 添加一键复制按钮和删除按钮
                        const actionCell = document.createElement('td');
                        const copyButton = document.createElement('button');
                        copyButton.textContent = "一键复制";
                        copyButton.className = "copyButton";
                        copyButton.onclick = function() {
                            copySerialNumber(serialCell);
                        };
                        actionCell.appendChild(copyButton);

                        const deleteButton = document.createElement('button');
                        deleteButton.textContent = "删除";
                        deleteButton.className = "deleteButton";
                        deleteButton.onclick = function() {
                            newTableBody.removeChild(newRow);
                        };
                        actionCell.appendChild(deleteButton);

                        newRow.appendChild(actionCell);

                        newTableBody.appendChild(newRow);
                    }
                });

                if (rowCountForOrder === 0) {
                    updateResponseBox(`未找到订单号 ${orderNumber} 的任何匹配行。`);
                }
            });

            updateResponseBox("自动新增完成。");
        }

        // 复制序列号内容的函数
        function copySerialNumber(serialCell) {
            const serialNumber = serialCell.textContent.trim();
            if (serialNumber === "") {
                updateResponseBox("序列号为空，无法复制！");
                return;
            }

            // 创建一个临时文本区域来复制内容
            const tempInput = document.createElement('textarea');
            tempInput.value = serialNumber;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);

            updateResponseBox("已复制序列号: " + serialNumber);
        }

        async function submitDataToBackend() {
            const tableData = [];
            document.querySelectorAll(`#contentPreview2 table`).forEach(table => {
                const headerData = Array.from(table.querySelectorAll('th')).map(th => th.textContent.trim());
                const tableInfo = { header: headerData, rows: [] };
                table.querySelectorAll('tbody tr').forEach(row => {
                    const rowData = Array.from(row.querySelectorAll('td')).map(td => td.textContent.trim());
                    tableInfo.rows.push(rowData);
                });
                tableData.push(tableInfo);
            });

            // 将数据转换为 CSV 格式字符串
            let csvContent = "";
            tableData.forEach((table) => {
                csvContent += table.header.join(",") + "\n";
                table.rows.forEach(row => {
                    csvContent += row.join(",") + "\n";
                });
            });

            try {
                const response = await fetch('http://127.0.0.1:5000/api/saveData', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: csvContent
                });

                if (response.ok) {
                    updateResponseBox('数据导出成功');
                } else {
                    const responseData = await response.json();
                    updateResponseBox(`数据导出失败：${responseData.message}`);
                }
            } catch (error) {
                updateResponseBox(`数据导出失败：${error.message}`);
            }
        }

        function updateResponseBox(message) {
            const responseMessage = document.getElementById('responseMessage');
            responseMessage.textContent = message;
        }

        function addCopyToSOCells() {
            document.querySelectorAll(`#contentPreview2 table tbody tr`).forEach(row => {
                const soCell = row.children[1]; // Assuming the SO column is the second column
                if (soCell && !soCell.querySelector('.copyIcon')) {
                    const copyIcon = document.createElement('span');
                    copyIcon.textContent = '📋';
                    copyIcon.style.cursor = 'pointer';
                    copyIcon.className = 'copyIcon';
                    copyIcon.style.marginLeft = '5px';
                    copyIcon.onclick = function() {
                        copySO(soCell);
                    };
                    soCell.appendChild(copyIcon);
                }
            });
        }

        function copySO(soCell) {
            const soNumber = soCell.childNodes[0] ? soCell.childNodes[0].textContent.trim() : soCell.textContent.trim();
            if (soNumber === "") {
                updateResponseBox("SO 号为空，无法复制！");
                return;
            }

            // 创建一个临时文本区域来复制内容
            const tempInput = document.createElement('textarea');
            tempInput.value = soNumber;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);

            updateResponseBox("已复制 SO 号: " + soNumber);
        }

        function validateData() {
            if (!workbook) {
                updateResponseBox("请先选择数据验证文件。");
                return;
            }

            const validationSheet = workbook.Sheets[workbook.SheetNames[0]];
            if (!validationSheet) {
                updateResponseBox("未找到有效的工作表。");
                return;
            }

            const validationData = XLSX.utils.sheet_to_json(validationSheet, { header: 1 });
            const soIndex = validationData[0].indexOf("Order Reference ID");
            const skuIndex = validationData[0].indexOf("SKU");
            const validationOrders = validationData.slice(1);

            let resultMessage = "数据验证通过，所有 SO 和 SKU 匹配。";
            let allMatch = true;
            let mismatchedPairs = [];

            document.querySelectorAll(`#contentPreview2 table tbody tr`).forEach(row => {
                const soValue = row.children[1].textContent.replace(/📋/g, '').trim();
                const partNoValue = row.children[2].textContent.replace(/📋/g, '').trim();

                const matchingRows = validationOrders.filter(order => order[soIndex].toString().trim() === soValue);
                if (matchingRows.length > 0) {
                    const isMatch = matchingRows.some(order => order[skuIndex].toString().trim() === partNoValue);
                    if (!isMatch) {
                        allMatch = false;
                        mismatchedPairs.push({ so: soValue, partNo: partNoValue, expectedSku: matchingRows.map(row => row[skuIndex]).join(", ") });
                    }
                } else {
                    allMatch = false;
                    mismatchedPairs.push({ so: soValue, partNo: partNoValue, expectedSku: "未找到对应的 SKU" });
                }
            });

            if (allMatch) {
                updateResponseBox(resultMessage);
            } else {
                resultMessage = "数据验证失败，以下 SO 和 Part No 不匹配：\n";
                mismatchedPairs.forEach(pair => {
                    resultMessage += `SO: ${pair.so}, 页面 Part No: ${pair.partNo}, 期望 SKU: ${pair.expectedSku}\n`;
                });
                updateResponseBox(resultMessage);
            }
        }

    </script>
</body>
</html>
