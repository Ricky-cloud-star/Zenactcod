<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 2</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            let table = $("#dataTable tbody");

            // Add Row Button
            $("#addRow").click(function() {
                let newRow = `<tr>
                    <td><input type="text" name="so" placeholder="Enter SO"></td>
                    <td><input type="text" name="partNo" placeholder="Enter Part No"></td>
                    <td><input type="text" name="qty" placeholder="Enter Quantity"></td>
                    <td><input type="text" name="serialNo" placeholder="Enter Serial No"></td>
                    <td><input type="date" name="date"></td>
                    <td><button class="deleteRow">Delete</button></td>
                </tr>`;
                table.append(newRow);
            });

            // Delete Row Button
            table.on("click", ".deleteRow", function() {
                $(this).closest("tr").remove();
            });

            // Submit Data Button
            $("#submitData").click(function() {
                let rowData = [];
                $("#dataTable tbody tr").each(function() {
                    let row = {
                        so: $(this).find("input[name='so']").val(),
                        partNo: $(this).find("input[name='partNo']").val(),
                        qty: $(this).find("input[name='qty']").val(),
                        serialNo: $(this).find("input[name='serialNo']").val(),
                        date: $(this).find("input[name='date']").val()
                    };
                    rowData.push(row);
                });

                // Send data to the backend
                $.ajax({
                    url: "http://127.0.0.1:5000/api/saveData",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({ data: rowData }),
                    success: function(response) {
                        alert(response.message);
                    },
                    error: function(xhr, status, error) {
                        alert("提交过程中发生错误: " + xhr.responseText);
                    }
                });
            });

            // Import Data Button
            $("#importData").click(function() {
                // Fetch data from the backend
                $.ajax({
                    url: "http://127.0.0.1:5000/api/getData",
                    type: "GET",
                    success: function(response) {
                        table.empty(); // Clear existing rows
                        response.data.forEach(function(row) {
                            let newRow = `<tr>
                                <td><input type="text" name="so" value="${row.so}"></td>
                                <td><input type="text" name="partNo" value="${row.partNo}"></td>
                                <td><input type="text" name="qty" value="${row.qty}"></td>
                                <td><input type="text" name="serialNo" value="${row.serialNo}"></td>
                                <td><input type="date" name="date" value="${row.date}"></td>
                                <td><button class="deleteRow">Delete</button></td>
                            </tr>`;
                            table.append(newRow);
                        });
                    },
                    error: function(xhr, status, error) {
                        alert("导入过程中发生错误: " + xhr.responseText);
                    }
                });
            });
        });
    </script>
</head>
<body>
    <h1>Module 2 Data Entry</h1>
    <button id="addRow">Add Row</button>
    <button id="submitData">Submit Data</button>
    <button id="importData">Import Data</button>
    <table id="dataTable" border="1">
        <thead>
            <tr>
                <th>SO</th>
                <th>Part No</th>
                <th>Quantity</th>
                <th>Serial No</th>
                <th>Date</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</body>
</html>
